---
title: "Invasive_wrack_manuscript_code"
author: "Ric DeSantiago"
date: "12/15/2021"
output:
  pdf_document: default
  html_document: default
  word_document: default
editor_options:
  chunk_output_type: console
---

# Libraries

```{r libraries}
library(knitr)
library(jtools)
library(tidyverse)
library(tidyr)
library(ggplot2)
library(ggfortify)
library(lme4)
library(car)
library(nlme)
library(ggpubr)
library(multcompView)
library(boot)
library(Hotelling)
library(mvnTest)
library(vegan)
library(factoextra)
library(FactoMineR)
library(agricolae)
library(glmm)
library(HH)
library(ggpubr)
library(cran)
library(rstatix)
#hi
```

# Load Field Surveys

```{r}

wrack<-read.csv("InvasiveWrackSurveySNIJan2020.csv", header = TRUE)
view(wrack)
Grazer_Survey_Data <- read.csv("GrzrOnOffSurveySNIJan2020.csv") 
view(Grazer_Survey_Data)

```

## Wrack surveys

```{r}
#make a new column in datasheet for the proportion of total wrack patty area made up of sargassum
wrack$propsarg <- wrack$sarg_total / wrack$ellipse_A_m2

#make new column to show proportion of total made up of macrocystis (1-sargassum)
wrack$propmac<- 1 - wrack$propsarg

#make graph to show these proportions
ggplot(data=wrack, aes(x=site, y=propmac, fill=propsarg)) + 
  geom_bar(position="fill", stat="identity")


```

### Invasive Wrack usage survey

```{r}
Grazer_Survey_Data <- read.csv("GrzrOnOffSurveySNIJan2020.csv") 

#we want to remove any row that has double 0's, so a 0 for on and a 0 for off, this is because not every recorder recorded 0's when animals weren't seen. Therefore, by keeping double 0's in, we're inflating the likelihood of not finding an animal

Grazer_Survey_Data_edited <- Grazer_Survey_Data 
Grazer_Survey_Data_edited<- mutate(Grazer_Survey_Data_edited, Grazer_sum = on_wrack + off_wrack) 
filter(Grazer_Survey_Data_edited, Grazer_sum != 0)
#this removed 13 observations
view(Grazer_Survey_Data_edited)

#create a dataframe with just important columns
Grazer_Survey_Data_reduced <- na.omit(Grazer_Survey_Data_edited[, -c(1:3, 5, 7)])

#Change to long format
Grazer_Survey_Data_long <- gather(data = Grazer_Survey_Data_reduced, 
                                 key = "Wrack.Use", value = "Grazer_sum", c(on_wrack, off_wrack), factor_key = TRUE)

#Barplot
barplot<- ggplot(Grazer_Survey_Data_long, aes(fill=Wrack.Use, y=Grazer_sum, x=grzr_sp)) + 
    geom_bar(position="dodge", stat="identity")

barplot

pdf(file = "On.off_grazersurvey_Jan2020SanNic.pdf", width = 6, height = 4, useDingbats=F)

# Plot_Bar_g <- ggplot(data=meanAbundance_grazer,
#                      aes(y=mean_Abundance, 
#                          x=grzr_sp, 
#                          fill = Wrack.Use)) +
#  geom_bar(stat = "identity", colour = "black", 
#           position = position_dodge(width = 0.9)) 
#
#Plot_Bar_g + theme(axis.title.x = element_text(face="bold",
#                                                size=22),
#                           axis.text.x  = element_text(size=20)) + 
# xlab("Grazer") +
#  theme(axis.title.y = element_blank()) + 
#  ylab("Count (max 20)") +
#  theme(axis.title.y = element_text(angle=90, 
#                                    face="bold", 
#                                    size=22, 
#                                    vjust=1.5),
#        axis.text.y  = element_text(size=20)) +
#  geom_errorbar(aes(ymin=mean_Abundance - SE, 
#                    ymax=mean_Abundance + SE), width = 0.05,
#                position=position_dodge(width = 0.9)) +
#  scale_fill_manual(name = "Wrack usage",
#                    values = c("#999999", "#009E73")) +
#  theme(legend.justification=c(.5,.5), legend.position=c(.18,.88)) +
#  scale_y_continuous(expand = expand_scale(mult = c(0, 0)),
#                     breaks = pretty(c(0,20), n = 5), 
#                    limits = c(0,20)) )
#
#dev.off()

#let's extract the sample sizes for each of the grazers bc we didn't see grazers everytime

#Grazer_Survey_Data_reduced %>% 
# count(grzr_sp)

```

# Choice Assays

```{r}
#import and name data
LabAssayWholeTissue <-read.csv("LabAssaysWholeTissue.csv",header=T)
View(LabAssayWholeTissue)

#ensure factors are correctly read
is.numeric(LabAssayWholeTissue$algae_Wd)
is.factor(LabAssayWholeTissue$algae_spp.)
LabAssayWholeTissue$algae_spp.<-as.factor(LabAssayWholeTissue$algae_spp.)

AllSpeciesWholeTissue<-ggplot(LabAssayWholeTissue, aes(x=grazer_spp., y=algae_Wd, fill= algae_spp.)) + geom_boxplot() + theme_bw()   + xlab("Algae Species") + ylab("Total Consumed (g)") + ggtitle("Live algae choice assay") + theme(plot.title =element_text(hjust = 0.5))
AllSpeciesWholeTissue
```

## Tegula

```{r}
#read and rename file
WholeTissueAssay <- read.csv("LabAssaysWholeTissue.csv",header=T)
View(WholeTissueAssay)

#subset the tegula rows
tegula<-subset(LabAssayWholeTissue, grazer_spp.== "Tegula")
view(tegula)

#since controls were solely used for correction of autogenic growth, we can further subset to only look at the experimental treatments
tegulachoice <- subset(tegula, trt == "exp")
view(tegulachoice)

#look at the data in boxplots to visualize the spread around the median
tegbox<-ggplot(tegulachoice, aes(x=Location, y=Lo)) + geom_boxplot()
tegbox

#there seems to be an outlier in each treatment that may be pulling distributions, however, we are leaving outliers in as they are biological real.

#separate the histogram by species of algae to visually determine if the distributions of differences (f-i, adjusted for autogenic growth) look normal
#sargassum
tegulachoicesarg<-subset(tegulachoice, algae_spp. == "sargassum")
ggplot(tegulachoicesarg, aes(x=algae_Wd)) + geom_histogram(binwidth=0.1)
mean(tegula$algae_Wd[tegula$algae_spp.== 'sargassum'],na.rm = T)
sd(tegula$algae_Wd[tegula$algae_spp.== 'sargassum'],na.rm = T)

#macrocystis
tegulachoicemacro<-subset(tegulachoice, algae_spp. == "macro")
ggplot(tegulachoicemacro, aes(x=algae_Wd)) + geom_histogram(binwidth=0.1)
mean(tegula$algae_Wd[tegulachoice$algae_spp.== 'macro'],na.rm = T)
sd(tegula$algae_Wd[tegulachoice$algae_spp.== 'macro'],na.rm = T)

#test for normality
par(mfrow=c(2,2))
qqnorm(tegulachoicemacro$algae_Wd)
qqline(tegulachoicemacro$algae_Wd)
qqnorm(tegulachoicesarg$algae_Wd)
qqline(tegulachoicesarg$algae_Wd)
# when graphing the sample quantities versues theoretical, we can see that the data tend to center around the fitted line. We can proceed.

### To address the question "Do grazers show a preference between S. horneri or M. pyrifera?" we will use consumption as a proxy for choice. Thus, we can use a paired T test to see if there is a difference in "total consumed" between S. horneri and M. pyrifera.
####Paired t-tests are essentially one-sample t-tests, but you are comparing a distribution of DIFFERENCES to a theoretical one rather than a distribution of sample statistics. The original data are not used, rather the mean, variance, and standard deviation are based on the DIFFERENCES. Thus, we don't need equal variances, only normal distribution of means and equal sample size. 

####make the data in "wide form" to create column to display differences#####
#create a dataframe with just important columns
tegdiffs <- na.omit(tegulachoice[, -c(1:8, 10:12, 14:22)])
view(tegdiffs)
#subset S.horneri only
tegdiffs2<-subset(tegdiffs, algae_spp. == "sargassum")
view(tegdiffs2)
#subset M. pyrifera only
tegdiffs3<-subset(tegdiffs, algae_spp. == "macro")
view(tegdiffs3)
#Bind the two datasets in "wide form"
tegdiffs4<- bind_cols(tegdiffs2,tegdiffs3)
view(tegdiffs4)
#create new column with the differences by subtracting S. horneri consumed from M. pyrifera consumed
tegdiffs5<- mutate(tegdiffs4, diffs = algae_Wd...4 - algae_Wd...2) 
view(tegdiffs5)

#check for normality of the differences
ggplot(tegdiffs5, aes(x=diffs)) + geom_histogram(binwidth=0.01)
qqnorm(tegdiffs5$diffs)
qqline(tegdiffs5$diffs)
#there seems to be an outlier, however, the data look normally distributed around the theoretical line. We can proceed to a paired T test
```

### Tegula Analysis

```{r}
#we will conduct a paired-T test.

## H0: There is no difference in total consumed between S. horneri and M. pyrifera  (i.e. there is no choice between algae).
## HA: There is a difference in total consumed between S. horneri and M. pyrifera  (i.e. there is a choice between algae).

#T test
t.test(tegulachoice$algae_Wd~tegulachoice$algae_spp., mu=0, alt="two.sided", paired=T,conf.level=0.95)
## we reject the null hypothesis (t = 5.7152, df = 13, p-value = 7.111e-05), there was a choice made between algae

#make boxplot 
ggplot(tegula, aes(x=algae_spp., y=algae_Wd, fill= algae_spp.))+ geom_boxplot() + theme_bw()  + guides() + xlab("Algae Species") + ylab(" Consumtion (g)") + ggtitle("M. pyrifera vs. S. horneri whole tissue consumption by T. funebralis") + theme(plot.title =element_text(hjust = 0.5)) 

#When given a choice between S. horneri and M. pyrifera, Tegula preferred M. pyrifera.

##this analysis will be repeated for all other grazers.

```

## Striped Shore Crab

```{r}
#subset the P. crassipes rows
pachy<-subset(LabAssayWholeTissue, grazer_spp.== "Pachy")
view(pachy)

#since controls were solely used for correction of autogenic growth, we can further subset to only look at the experimental treatments
pachychoice <- subset(pachy, trt == "exp")
view(pachychoice)

#visualize data

#look at the data in boxplots to visualize the spread around the median
ggplot(pachychoice, aes(x=algae_spp., y=algae_Wd)) + geom_boxplot()
#there seems to be an outlier in the S. horneri treatment that may be pulling the distribution


#separate the histogram by species of algae to visually determine if the distributions of differences (f-i, adjusted for autogenic growth) look normal
#sargassum
pacchoicesarg<-subset(pachychoice, algae_spp. == "sargassum")
ggplot(pacchoicesarg, aes(x=algae_Wd)) + geom_histogram(binwidth=0.1)
mean(pacchoicesarg$algae_Wd[pacchoicesarg$algae_spp.== 'sargassum'],na.rm = T)
sd(pacchoicesarg$algae_Wd[pacchoicesarg$algae_spp.== 'sargassum'],na.rm = T)

#macrocystis
pacchoicemac<-subset(pachychoice, algae_spp. == "macro")
ggplot(pacchoicemac, aes(x=algae_Wd)) + geom_histogram(binwidth=0.1)
mean(pacchoicemac$algae_Wd[pacchoicemac$algae_spp.== 'macro'],na.rm = T)
sd(pacchoicemac$algae_Wd[pacchoicemac$algae_spp.== 'macro'],na.rm = T)

#test for normality
par(mfrow=c(2,2))
qqnorm(pacchoicemac$algae_Wd)
qqline(pacchoicemac$algae_Wd)
qqnorm(pacchoicemac$algae_Wd)
qqline(pacchoicemac$algae_Wd)

####make the data in "wide form" to create column to display differences#####
#create a dataframe with just important columns
pacdiffs <- na.omit(pachychoice[, -c(1:8, 10:12, 14:22)])
view(pacdiffs)
#subset S.horneri only
pacdiffs2<-subset(pacdiffs, algae_spp. == "sargassum")
view(pacdiffs2)
#subset M. pyrifera only
pacdiffs3<-subset(pacdiffs, algae_spp. == "macro")
view(pacdiffs3)
#Bind the two datasets in "wide form"
pacdiffs4<- bind_cols(pacdiffs2,tegdiffs3)
view(pacdiffs4)
#create new column with the differences by subtracting S. horneri consumed from M. pyrifera consumed
pacdiffs5<- mutate(pacdiffs4, diffs = algae_Wd...4 - algae_Wd...2) 
view(pacdiffs5)

qqnorm(pacdiffs5$diffs)
qqline(pacdiffs5$diffs)
#we will conduct a paired-T test.


```

### Striped Shore Crab Analysis

```{r}

## H0: There is no difference in total consumed between S. horneri and M. pyrifera  (i.e. there is no choice between algae).
## HA: There is a difference in total consumed between S. horneri and M. pyrifera  (i.e. there is a choice between algae).


#T test
t.test(pachychoice$algae_Wd~pachychoice$algae_spp., mu=0, alt="two.sided", paired=T,conf.level=0.95)
## we fail reject the null hypothesis (t = 0.073928, df = 13, p-value = 0.9422), there was no choice made between algae


#make boxplot 
ggplot(pachy, aes(x=algae_spp., y=algae_Wd, fill= algae_spp.))+ geom_boxplot() + theme_bw()  + guides() + xlab("Algae Species") + ylab(" Consumtion (g)") + ggtitle("M. pyrifera vs. S. horneri whole tissue consumption by P. crassipes ") + theme(plot.title =element_text(hjust = 0.5)) 

#When given a choice between S. horneri and M. pyrifera, P. Crassipes showed no preference.
```

## Hermit Crab

```{r}

#subset the P. samuelis rows
pagurus<-subset(LabAssayWholeTissue, grazer_spp.== "Pagurus")
view(pagurus)

#since controls were solely used for correction of autogenic growth, we can further subset to only look at the experimental treatments
paguruschoice <- subset(pagurus, trt == "exp")
view(paguruschoice)

#visualize data

#look at the data in boxplots to visualize the spread around the median
ggplot(paguruschoice, aes(x=algae_spp., y=algae_Wd)) + geom_boxplot()

#separate the histogram by species of algae to visually determine if the distributions of differences (f-i, adjusted for autogenic growth) look normal
#sargassum
pagchoicesarg<-subset(paguruschoice, algae_spp. == "sargassum")
ggplot(pagchoicesarg, aes(x=algae_Wd)) + geom_histogram(binwidth=0.1)
mean(pagchoicesarg$algae_Wd[pagchoicesarg$algae_spp.== 'sargassum'],na.rm = T)
sd(pagchoicesarg$algae_Wd[pagchoicesarg$algae_spp.== 'sargassum'],na.rm = T)

#macrocystis
pagchoicemac<-subset(paguruschoice, algae_spp. == "macro")
ggplot(pagchoicemac, aes(x=algae_Wd)) + geom_histogram(binwidth=0.1)
mean(pagchoicemac$algae_Wd[pagchoicemac$algae_spp.== 'macro'],na.rm = T)
sd(pagchoicemac$algae_Wd[pagchoicemac$algae_spp.== 'macro'],na.rm = T)

#test for normality
par(mfrow=c(2,2))
qqnorm(pagchoicemac$algae_Wd)
qqline(pagchoicemac$algae_Wd)
qqnorm(pagchoicesarg$algae_Wd)
qqline(pagchoicesarg$algae_Wd)

#there seems to be an outlier on both ends, however, the data look normally distributed around the theoretical line
pagdiffs <- na.omit(paguruschoice[, -c(1:8, 10:12, 14:22)])
view(pagdiffs)
#subset S.horneri only
pagdiffs2<-subset(pagdiffs, algae_spp. == "sargassum")
view(pagdiffs2)
#subset M. pyrifera only
pagdiffs3<-subset(pagdiffs, algae_spp. == "macro")
view(pagdiffs3)
#Bind the two datasets in "wide form"
pagdiffs4<- bind_cols(pagdiffs2,tegdiffs3)
view(pagdiffs4)
#create new column with the differences by subtracting S. horneri consumed from M. pyrifera consumed
pagdiffs5<- mutate(pagdiffs4, diffs = algae_Wd...4 - algae_Wd...2) 
view(pagdiffs5)

qqnorm(pagdiffs5$diffs)
qqline(pagdiffs5$diffs)
#we will conduct a paired-T test.

```

### Hermit Crab Analysis

```{r}
#T test

## H0: There is no difference in total consumed between S. horneri and M. pyrifera  (i.e. there is no choice between algae).
## HA: There is a difference in total consumed between S. horneri and M. pyrifera  (i.e. there is a choice between algae).
t.test(paguruschoice$algae_Wd~paguruschoice$algae_spp., paired= TRUE)
## we reject the null hypothesis (t = -3.7593, df = 13, p-value = 0.002385), there was a choice made between algae


#make boxplot 
ggplot(pagurus, aes(x=algae_spp., y=algae_Wd, fill= algae_spp.))+ geom_boxplot() + theme_bw()  + guides() + xlab("Algae Species") + ylab(" Consumtion (g)") + ggtitle("M. pyrifera vs. S. horneri whole tissue consumption by P. samuelis ") + theme(plot.title =element_text(hjust = 0.5)) 

#When given a choice between S. horneri and M. pyrifera, P. samuelis showed a preference for sargassum .
```

## Black Abalone

```{r}
## conducte September 2019
#subset the A. cracherodii rows
abalone<-subset(LabAssayWholeTissue, grazer_spp.== "Haliotis cracherodii")
view(abalone)

#since controls were solely used for correction of autogenic growth, we can further subset to only look at the experimental treatments
abalonechoice <- subset(abalone, trt == "Experimental")
view(abalonechoice)

#visualize data

#look at the data in boxplots to visualize the spread around the median
ggplot(abalonechoice, aes(x=algae_spp., y=algae_Wd)) + geom_boxplot()


#separate the histogram by species of algae to visually determine if the distributions of differences (f-i, adjusted for autogenic growth) look normal
#sargassum
abchoicesarg<-subset(abalonechoice, algae_spp. == "sargassum")
ggplot(abchoicesarg, aes(x=algae_Wd)) + geom_histogram(binwidth=0.1)
mean(abchoicesarg$algae_Wd[abchoicesarg$algae_spp.== 'sargassum'],na.rm = T)
sd(abchoicesarg$algae_Wd[abchoicesarg$algae_spp.== 'sargassum'],na.rm = T)

#macrocystis
abchoicemac<-subset(abalonechoice, algae_spp. == "macro")
ggplot(abchoicemac, aes(x=algae_Wd)) + geom_histogram(binwidth=0.1)
mean(abchoicemac$algae_Wd[abchoicemac$algae_spp.== 'macro'],na.rm = T)
sd(abchoicemac$algae_Wd[abchoicemac$algae_spp.== 'macro'],na.rm = T)

#test for normality
par(mfrow=c(2,2))
qqnorm(abchoicesarg$algae_Wd)
qqline(abchoicesarg$algae_Wd)
qqnorm(abchoicemac$algae_Wd)
qqline(abchoicemac$algae_Wd)

####make the data in "wide form" to create column to display differences#####
#create a dataframe with just important columns
abdiffs <- na.omit(abalonechoice[, -c(1:8, 10:12, 14:22)])
view(abdiffs)
#subset S.horneri only
abdiffs2<-subset(abdiffs, algae_spp. == "sargassum")
view(abdiffs2)
#subset M. pyrifera only
abdiffs3<-subset(abdiffs, algae_spp. == "macro")
view(abdiffs3)
#Bind the two datasets in "wide form"
abdiffs4<- bind_cols(abdiffs2,abdiffs3)
view(abdiffs4)
#create new column with the differences by subtracting S. horneri consumed from M. pyrifera consumed
abdiffs5<- mutate(abdiffs4, diffs = algae_Wd...4 - algae_Wd...2) 
view(abdiffs5)

qqnorm(abdiffs5$diffs)
qqline(abdiffs5$diffs)
#we will conduct a paired-T test.

```

### Black Abalone Analysis

```{r}
## H0: There is no difference in total consumed between S. horneri and M. pyrifera  (i.e. there is no choice between algae).
## HA: There is a difference in total consumed between S. horneri and M. pyrifera  (i.e. there is a choice between algae).


#T test
t.test(abalonechoice$algae_Wd~abalonechoice$algae_spp., mu=0, alt="two.sided", paired=T,conf.level=0.95)
## we reject the null hypothesis (4.5053, df = 15, p-value = 0.0004189), there was a choice made between algae


#make boxplot 
ggplot(abalonechoice, aes(x=algae_spp., y=algae_Wd, fill= algae_spp.))+ geom_boxplot() + theme_bw()  + guides() + xlab("Algae Species") + ylab(" Consumtion (g)") + ggtitle("M. pyrifera vs. S. horneri whole tissue consumption by H. cracherodii ") + theme(plot.title =element_text(hjust = 0.5)) 

#When given a choice between S. horneri and M. pyrifera, H. cracherodii showed a preference for M. pyriferae.

```

# Performance Assays (March-April 2020)

```{r}
#load data
performance<-read.csv("PerformanceAssays2020.csv", header=TRUE)
view(performance)
na.omit(performance)

is.numeric(performance$wetmass_total_Wd)
performance$wetmass_total_Wd<-as.numeric(performance$wetmass_total_Wd)
is.factor(performance$treatment)
performance$treatment<-as.factor(performance$treatment)


#create new column to look at dry weight difference (Wf-Wi) as a proportion of initial weight (Wd/Wi *100) to visualize weight differences from begining to end using estimated starting weights (see section "estimated intial masses")
performance<-mutate(performance, dry_mass_percent_change = ((terminal_total_dry_mass - est_total_dry_mass_i)/ est_total_dry_mass_i)* 100)
view(performance)

ggplot(performance, aes(y=dry_mass_percent_change, x=diet)) + geom_boxplot()

```

## Red Abalone (Data Exploration)

```{r}

#subset data for abalone
redabaloneperformance<-subset(performance, grazer_spp.== "red abalone")
view(redabaloneperformance)

#visualize data
ggplot(redabaloneperformance, aes(y=terminal_dry_tissue_mass, x=diet)) + geom_boxplot()
#histogram
ggplot(redabaloneperformance, aes(x=terminal_dry_tissue_mass)) + geom_histogram(binwidth=0.1)
#the data look fairly normal when combined, the histogram shows the distribution tailes to the left having some numbers in the negative, this is likely due to the starved treatment.
##we will conduct ANOVA or GLMM if assumptions are met. Starved treatment is used as a control and to detect if any food treatment is worse than starvation (e.g., toxic and harmful algae), thus, starved treatments will not be used unless a food treatment causes more mass loss than starved. 

#explore the data 

#make boxplot for initial wet mass
ggplot(redabaloneperformance, aes(x=diet, y=wetmass_i , fill= diet)) + geom_boxplot() + theme_bw()   + xlab("Diet") + ylab("H. rufescens Wet Mass (g)") + ggtitle("H. rufescens initial wet mass") + theme(plot.title =element_text(hjust = 0.5))

#make boxplot of final wet mass
ggplot(redabaloneperformance, aes(x=diet, y=wetmass_f , fill= diet)) + geom_boxplot() + theme_bw()   + xlab("Diet") + ylab("H. rufescens Wet Mass (g)") + ggtitle("H. rufescens final wet mass by diet") + theme(plot.title =element_text(hjust = 0.5))

#make boxplot for mass difference
ggplot(redabaloneperformance, aes(x=diet, y=wetmass_total_Wd , fill= diet)) + geom_boxplot() + theme_bw()   + xlab("Diet") + ylab("H. rufescens change in wet Mass (g)") + ggtitle("H. rufescens mass change by diet") + theme(plot.title =element_text(hjust = 0.5))
#aside from the variabilty in weights due to water, starved treatment has a mean below zero while others are above 

#look at DRY mass based on tissue type

#make boxplot of final dry mass
ggplot(redabaloneperformance, aes(x=diet, y=terminal_dry_tissue_mass , fill= diet)) + geom_boxplot() + theme_bw()   + xlab("Diet") + ylab("H. rufescens Dry Mass (g)") + ggtitle("H. rufescens final wet dry by diet") + theme(plot.title =element_text(hjust = 0.5))

#make boxplot of final gonad/gill/digestive dry mass by diet
ggplot(redabaloneperformance, aes(x=diet, y=terminal_gonad_dry_mass, fill= diet)) + geom_boxplot() + theme_bw()   + xlab("Diet") + ylab("Gonad Dry Mass (g)") + ggtitle("H. rufescens final gonad/gill/GI mass by diet") + theme(plot.title =element_text(hjust = 0.5))

#make boxplot of final foot dry mass by diet
ggplot(redabaloneperformance, aes(x=diet, y=terminal_nongonad_dry_mass, fill= diet)) + geom_boxplot() + theme_bw()   + xlab("Diet") + ylab("Tissue Dry Mass (g)") + ggtitle("H. rufescens final non-gonad dry mass by diet") + theme(plot.title =element_text(hjust = 0.5))

#make boxplot of final shell dry mass by diet
ggplot(redabaloneperformance, aes(x=diet, y=terminal_shell_dry_mass , fill= diet)) + geom_boxplot() + theme_bw()   + xlab("Diet") + ylab("Shell Dry Mass (g)") + ggtitle("H. rufescens final shell dry mass by diet") + theme(plot.title =element_text(hjust = 0.5))


```

### Red Abalone Initial Mass Estimations

```{r}

#test if there is a significant difference in initial wet masses using a simple anova
initialmassabs<-aov(redabaloneperformance$wetmass_i ~ redabaloneperformance$diet)
summary(initialmassabs)
#we fail to reject the null hypothesis (p = 0.24), the treatments are not different

##To reduce variability due to water weight, we estimated initial DRY masses through regression analysis using shell lengths to predict dry weight using a sub-sample of the population before the experiment

#read and rename file
regressions <- read.csv("regressiondata.csv",header=T)
View(regressions)

#subset abalone
regressionsub<-subset(regressions, Species == "Ab")

#explore data
mean(regressionsub$Dissected_total_dry_weight)
sd(regressionsub$Dissected_total_dry_weight)
hist(regressionsub$Dissected_total_dry_weight)
mean(regressionsub$Shell_L)
sd(regressionsub$Shell_L)
hist(regressionsub$Shell_L)

#simple scatterplot and pearson correlation
plot(regressionsub$Dissected_total_dry_weight, regressionsub$Shell_L, data = regressionsub, main = "scatterplot")
cor(regressionsub$Dissected_total_dry_weight, regressionsub$Shell_L)

#Abalone models 

#model 1
#regression to predict total dry mass from shell length
mod<-lm(Dissected_total_dry_weight ~ Shell_L, data = regressionsub)
summary(mod)
attributes(mod)

#add the line
abregplot<- plot(regressionsub$Shell_L, regressionsub$Dissected_total_dry_weight, main = "regression",
     xlab = "Shell Length", ylab = "Total Dry Tissue",
     pch = 19, frame = FALSE) +
abline(lm(regressionsub$Dissected_total_dry_weight ~ regressionsub$Shell_L)) 
#Model 1: Total sum of dry tissue     Formula y= 0.56064x -22.41711


#model 2
#regression to predict foot dry tissue mass from shell length
mod2<-lm(Dissected_nongonad_dry_weight ~ Shell_L, data = regressionsub)
summary(mod2)
attributes(mod2)

#add the line
abregplot2<- plot(regressionsub$Shell_L, regressionsub$Dissected_nongonad_dry_weight, main = "regression",
     xlab = "Shell Length", ylab = "Foot Dry Tissue",
     pch = 19, frame = FALSE) +
abline(lm(regressionsub$Dissected_nongonad_dry_weight ~ regressionsub$Shell_L)) 
#Model 2: Foot dry tissue               Formal y= 0.10928x - 4.64417


#Model3

#regression to predict gill/gut/gonad tissue mass from shell length
mod3<-lm(Dissected_gonad_dry_weight ~ Shell_L, data = regressionsub)
summary(mod3)
attributes(mod3)

#add the line
abregplot3<- plot(regressionsub$Shell_L, regressionsub$Dissected_ab_gonad_dry_weight, main = "regression",
     xlab = "Shell Length", ylab = "Gill/gut/gonad complex Dry Tissue",
     pch = 19, frame = FALSE) +
abline(lm(regressionsub$Dissected_ab_gonad_dry_weight ~ regressionsub$Shell_L)) 
#Model 3: gill/gut/gonad complex dry tissue        Formula y= 0.049014x -1.990739

#model 4

#regression to predict soft tissue mass from shell length
mod4<-lm(Dissected_tissue_dry_weight ~ Shell_L, data = regressionsub)
summary(mod4)
attributes(mod4)

#add the line
abregplot4<- plot(regressionsub$Shell_L, regressionsub$Dissected_tissue_dry_weight, main = "regression",
     xlab = "Shell Length", ylab = "Total soft tissue",
     pch = 19, frame = FALSE) +
abline(lm(regressionsub$Dissected_tissue_dry_weight ~ regressionsub$Shell_L)) 
#Model 4: total soft dry tissue        Formula y= 0.15829x -6.63491

#model 5
#regression to predict shell mass from shell length
mod5<-lm(Dissected_shell_dry_weight ~ Shell_L, data = regressionsub)
summary(mod5)
attributes(mod5)

#add the line
abregplot5<- plot(regressionsub$Shell_L, regressionsub$Dissected_shell_dry_weight, main = "regression",
     xlab = "Shell Length", ylab = "Total soft tissue",
     pch = 19, frame = FALSE) +
abline(lm(regressionsub$Dissected_shell_dry_weight ~ regressionsub$Shell_L)) 
#Model 5: shell dry mass        Formula y= 0.40234x -15.78220

#graph estimated total dry mass
ggplot(redabaloneperformance, aes(x=diet, y=est_total_dry_mass_i , fill= diet)) + geom_boxplot() + theme_bw()   + xlab("Diet") + ylab("Dry Mass (g)") + ggtitle("H. rufescens initial dry mass") + theme(plot.title =element_text(hjust = 0.5))



```

### Red Abalone Analysis

```{r}

#remove starved treatment
abmodels<-subset(redabaloneperformance, !diet== "starved")
view(abmodels)

#look at the data without starved treatment
#histogram
ggplot(abmodels, aes(x=terminal_total_dry_mass)) + geom_histogram(binwidth=01)
#when combined, the terminal dry masses show a left leaning distribution
 
#before proceeding check that there is no correlation between estimated initial dry weights and proportional change
reg<- plot(abmodels$est_total_dry_mass_i,abmodels$dry_mass_percent_change, frame = FALSE) +
abline(lm(abmodels$dry_mass_percent_change ~ abmodels$est_total_dry_mass_i)) 

#there seems to be a slight correlation between initial dry mass and percent change. Bigger individuals change less. Thus we will use initial weight estimates as a covariate to look at the effect of diet on size. By doing this, we account for initial weights but lose one degree of freedom

abmodel <- lm(terminal_total_dry_mass ~ diet * est_total_dry_mass_i , data = abmodels)
summary(abmodel)
# Create a QQ plot of residuals
par(mfrow = c(2, 2))
plot(abmodel)
#the data look fairly normal

#testing normality with a Shapiro-Wilk test
shapiro_test(residuals(abmodel))
#SW test fails to reject the Ho(p=0.594), the residuals are normally distributed

bartlett.test(terminal_total_dry_mass ~ diet, data=abmodels)
#Bartlett test fails to reject the null Ho (p-value =0.3937), thus we accept the hypothesis that our variances are equal


#Assumptions for ANCOVA are met, we can now run the analysis to answer the question:

#ANCOVA
#first we test if there is an interaction between the initial weights and the diets
int<-ggplot(abmodels, aes(y=terminal_total_dry_mass , x= est_total_dry_mass_i)) 
 
int +  geom_jitter(aes(col=diet)) + geom_smooth(aes(col=diet), method="lm", se=F)
#it looks like there could be an interaction when plotting, lets see if its significant

abmodel <- lm(terminal_total_dry_mass ~ est_total_dry_mass_i * diet , data = abmodels)
anova(abmodel)
#The interaction between the dependent variable and factor are not signficant(p=0.4179), we can test for significant effect of the factor without the interaction to ask the question "Does diet impact abalone weight?"

## H0: There is no relationship between diet and abalone weights
## HA: There is a relationship between diet and abalone weights 
abmodel <- aov(terminal_total_dry_mass ~ diet + est_total_dry_mass_i , data = abmodels)
Anova(abmodel, type = "III")
#We reject the H0 and embrace HA, Diet impacts abalone weights (p=0.0311)

#check residuals
par(mfrow = c(2,2))
plot(abmodel2)

#conduct Tukeys post hoc test to see how the treatments differ
redab.aov.HSD1 <- HSD.test(abmodel2 , trt = 'diet') 
print(redab.aov.HSD1)
plot(redab.aov.HSD1)
#all treatments differ from each other
```

## Tegula (Data Exploration)

```{r}
#subset data for tegula
tegulaperformance<-subset(performance, grazer_spp.== "tegula")

#histogram
ggplot(tegulaperformance, aes(x=terminal_dry_tissue_mass)) + geom_histogram()
#the data look fairly normal when combined

##we will conduct ANOVA or GLMM if assumptions are met. Starved treatment is used as a control and to detect if any food treatment is worse than starvation (e.g., toxic and harmful algae), thus, starved treatments will not be used unless a food treatment causes more mass loss than starved. 

#explore the data 

#make boxplot for initial wet mass
ggplot(tegulaperformance, aes(x=diet, y=wetmass_i , fill= diet)) + geom_boxplot() + theme_bw()   + xlab("Diet") + ylab("T. funebralis Wet Mass (g)") + ggtitle("T. funebralis initial wet mass") + theme(plot.title =element_text(hjust = 0.5))

#make boxplot of final wet mass
ggplot(tegulaperformance, aes(x=diet, y=wetmass_f , fill= diet)) + geom_boxplot() + theme_bw()   + xlab("Diet") + ylab("T. funebralis Wet Mass (g)") + ggtitle("T. funebralisfinal wet mass by diet") + theme(plot.title =element_text(hjust = 0.5))

#make boxplot for mass difference
ggplot(tegulaperformance, aes(x=diet, y=wetmass_total_Wd , fill= diet)) + geom_boxplot() + theme_bw()   + xlab("Diet") + ylab("T. funebralis change in wet Mass (g)") + ggtitle("T. funebralis mass change by diet") + theme(plot.title =element_text(hjust = 0.5))
#aside from the variabilty in weights due to water, starved treatment has a mean below zero while others are above 


#look at DRY mass based on tissue type

#make boxplot of final dry mass
ggplot(tegulaperformance, aes(x=diet, y=terminal_dry_tissue_mass , fill= diet)) + geom_boxplot() + theme_bw()   + xlab("Diet") + ylab("T. funebralis Dry Mass (g)") + ggtitle("T. funebralis final dry tissue by diet") + theme(plot.title =element_text(hjust = 0.5))

#make boxplot of final shell dry mass by diet
ggplot(tegulaperformance, aes(x=diet, y=terminal_shell_dry_mass , fill= diet)) + geom_boxplot() + theme_bw()   + xlab("Diet") + ylab("Shell Dry Mass (g)") + ggtitle("T. funebralis shell dry mass by diet") + theme(plot.title =element_text(hjust = 0.5))
```

### Tegula (Initial Mass Estimates)

```{r}
#test if there is a significant difference in initial wet masses using a simple anova
initialmassteg<-aov(tegulaperformance$wetmass_i ~ tegulaperformance$diet)
summary(initialmassteg)
#we fail to reject the null hypothesis (p = 0.687), the treatments are not different

##To reduce variance due to water weight, we estimated initial DRY masses through regression analysis using shell lengths to predict dry weight using a sub-sample of the population before the experiment

#read and rename file
regressions <- read.csv("regressiondata.csv",header=T)
View(regressions)

#subset abalone
tegregressions<-subset(regressions, Species == "Teg")
view(tegregressions)

#explore data
mean(tegregressions$Dissected_total_dry_weight)
sd(tegregressions$Dissected_total_dry_weight)
hist(tegregressions$Dissected_total_dry_weight)
mean(tegregressions$Real_L)
sd(tegregressions$Real_L)
hist(tegregressions$Real_L)

#simple scatterplot and pearson correlation
plot(tegregressions$Dissected_total_dry_weight, tegregressions$Real_L, data = tegregressions, main = "scatterplot")
cor(tegregressions$Dissected_total_dry_weight, tegregressions$Real_L)

#Tegula Model

#Teg Model 1 total dry tissue
tegmod1<-lm(Dissected_total_dry_weight ~ Real_L, data = tegregressions)
summary(tegmod1)
summ(tegmod)
attributes(tegmod1)

#add the line
tegplot1<- plot(tegregressions$Real_L, tegregressions$Dissected_total_dry_weight, main = "regression",
     xlab = "Shell Length", ylab = "Tegula Whole Tissue",
     pch = 19, frame = FALSE) +
abline(lm(tegregressions$Dissected_total_dry_weight ~ tegregressions$Real_L)) 

#Teg Model 1: total dry tissue    Y=  0.12235x -0.60049

#Teg Model 2 soft dry tissue
tegmod2<-lm(Dissected_tissue_dry_weight ~ Real_L, data = tegregressions)
summary(tegmod2)
attributes(tegmod2)

#add the line
tegplot2<- plot(tegregressions$Real_L, tegregressions$Dissected_tissue_dry_weight, main = "regression",
     xlab = "Shell Length", ylab = "Tegula Soft Tissue",
     pch = 19, frame = FALSE) +
abline(lm(tegregressions$Dissected_tissue_dry_weight ~ tegregressions$Real_L)) 
tegplot2
#Model 2: soft tissue dry tissue    Y=  0.004463x -0.014478

#Model 3 dry shell
tegmod3<-lm(Dissected_shell_dry_weight ~ Real_L, data = tegregressions)
summary(tegmod3)
attributes(tegmod3)

#add the line
tegplot3<- plot(tegregressions$Real_L, tegregressions$Dissected_shell_dry_weight, main = "regression",
     xlab = "Shell Length", ylab = "Tegula Shell ",
     pch = 19, frame = FALSE) +
abline(lm(tegregressions$Dissected_shell_dry_weight ~ tegregressions$Real_L)) 

#Teg Model 3: total dry tissue    Y=  0.117889x -0.586016

#graph estimated total dry mass
ggplot(tegulaperformance, aes(x=diet, y=est_total_dry_mass_i , fill= diet)) + geom_boxplot() + theme_bw()   + xlab("Diet") + ylab("Dry Mass (g)") + ggtitle("T.funebralis initial dry mass") + theme(plot.title =element_text(hjust = 0.5))

```

### Tegula Analysis

```{r}


#remove starved treatment
tegmodels<-subset(tegulaperformance, !diet== "starved")
view(tegmodels)

#look at the data without starved treatment
#histogram
ggplot(tegmodels, aes(x=terminal_total_dry_mass)) + geom_histogram(binwidth=0.01)
#when combined, the terminal dry masses show a left leaning distribution
 

# Build the linear model to test normality of residuals
# The model will look at 
Tegmodel <- lm(terminal_total_dry_mass ~ diet + est_total_dry_mass_i , data = tegmodels)
# Create a QQ plot of residuals
ggqqplot(residuals(Tegmodel))
#the data look normal but deviate toward the right end of the QQ plot. May need to address outliers

par(mfrow = c(2, 2))
plot(Tegmodel)
#the data look fairly normal

#test the homogeniety of variances 
bartlett.test(terminal_total_dry_mass ~ diet , data=tegmodels)
#Bartlet test fails to reject the null Ho (p-value =0.8136), thus we accept the hypothesis that our variances are equal


#Assumptions for ANCOVA are met, we can now run the analysis to answer the question:

#ANCOVA
#first we test if there is an interaction between the initial weights and the diets
int2<-ggplot(tegmodels, aes(y=terminal_total_dry_mass , x= est_total_dry_mass_i)) 
 
int2 +  geom_jitter(aes(col=diet)) + geom_smooth(aes(col=diet), method="lm", se=F)

tegmodel <- lm(terminal_total_dry_mass ~ est_total_dry_mass_i * diet , data = tegmodels)
anova(tegmodel)
#There is no interaction between the dependent variable and factor (p=0.5118), we can test for significant effect of the factor without the interaction to ask the question "Does diet impact tegula weight?"

## H0: There is no relationship between diet and tegula weights
## HA: There is a relationship between diet and tegula weights
tegmodel2 <- aov(terminal_total_dry_mass ~ est_total_dry_mass_i + diet , data = tegmodels)
Anova(tegmodel2, type = "III") #We will use a type 1 sums of squares to determine if there is diet has an effect on final weight after controlling for initial size
summary(tegmodel2)

#We reject the H0 and embrace HA, Diet impacts tegula weights (p=0.0141)
 
#check residuals
par(mfrow = c(2,2))
plot(tegmodel2)

#conduct Tukeys post hoc test to see how the treatments differ
redab.aov.HSD1 <- HSD.test(tegmodel2 , trt = 'diet') 
print(redab.aov.HSD1)
plot(redab.aov.HSD1)
#all treatments differ from each other
```

## Righting times

```{r}
righting<-read.csv("abalone righting tests.csv", header=TRUE)
view(righting)
na.omit(righting)

#subset out starved
righting.tests<-subset(righting, !diet== "starved")
view(righting.tests) #subset out the starved treatment


righting.mod1 <- aov(time_diff ~ diet, data = righting.tests)
# Create a QQ plot of residuals
anova(righting.mod1)


righting.aov.HSD1 <- HSD.test(righting.mod1 , trt = 'diet') 
print(righting.aov.HSD1)
plot(righting.aov.HSD1)






#make bargraph
performance<-read.csv("PerformanceAssays2020.csv", header=TRUE)
view(performance)
na.omit(performance)

#subset the abalone 
abperf<-subset(performance, grazer_spp.== "red abalone")
view(abperf) #subset out the starved treatment

#wrangle data to show attempt 1 and attempt 2 side by side for each treatment
gathered_obs<-gather(abperf, key="trial", value="time", 24:25)
view(gathered_obs)
na.omit(gathered_obs)
is.factor(gathered_obs$trial)
gathered_obs$trial<-as.factor(gathered_obs$trial)

rightingplot<- ggplot(gathered_obs, aes(x=diet, y=time, fill= trial)) + xlab("") + ylab("Time (sec)") + ggtitle("Righting Time Before and After Diet Treatment") + theme(axis.text=element_text(size=12)) + geom_bar(stat="identity",position=position_dodge()) + theme_minimal() +  
  scale_x_discrete(limits = c("starved", "macro", "mixed", "sargassum"), labels=c("starved" = "Starved", "macro" = "M. pyrifera","mixed" = "Mixed","sargassum" = "S. horneri")) +
   geom_vline(xintercept=c(1.5),linetype="dotted") +
  scale_fill_manual("",  values = c("righting_time_1" = "#1260AB", "righting_time_2" = "#009BFF"), labels=c("righting_time_1" = "Initial", "righting_time_2" = "Final")) 

rightingplot
#Overall, initial righting time was higher for starved treatment individuals followed by M. pyrifera, Mixed and S. horneri
##Final righting time increased for starved individuals, mixed, and S. horneri but decreased for M. pyrifera. 



```

# Wrack Dependent Community Assay

```{r}
community<-read.csv("Comm grazer exp.csv", header = T)
comm<-subset(community, Treatment=="Exp") #create a dataset for just the experimental treatments
view(comm)
```

## Exploring Data

```{r}
#lets look at TOTAL consumption to see how that differs between treatments
ggplot(community, aes(x= Wrack_treatment , y= Total_Algae_Consumed)) + theme_bw() + geom_boxplot() + ggtitle("Total Algae Consumed") + ylab("Total Consumption(g)") + xlab("Wrack treatment") + theme(plot.title =element_text(hjust = 0.5))
#Overall, the combined consumption of native benthic seaweeds + wrack appears to be generally lower in the invasive treatment but may not be significant

#lets look at how NATIVE BENTHIC SEAWEED consumption differs between treatments
ggplot(community, aes(x= Wrack_treatment , y= Total_Benthic_Algae_Consumed )) + theme_bw() + geom_boxplot() + ggtitle("Total Native Benthic Seaweed Consumed by Wrack Treatment") + ylab("Total Consumption(g)") + xlab("Wrack treatment") + theme(plot.title =element_text(hjust = 0.5))
#The  total biomass of native benthic seaweeds consumed appears to be higher in invasive treatment. Suggesting that consumption may have shifted onto NBS when S. horneri was introduced

#Now lets look at how consumption of just the WRACK species differs by Treatment
ggplot(community, aes(x= Wrack_treatment , y= Total_Wrack_Algae_Consumed )) + theme_bw() + geom_boxplot() + ggtitle("Total Wrack Consumed by Wrack Treatment") + ylab("Total Consumption(g)") + xlab("Wrack treatment") + theme(plot.title =element_text(hjust = 0.5))
#consumption of S. horneri appears to be much lower than consumption of M. pyrifera 

#lets look at the data of each species
#sargassum in Invasive
comm_sarg<-subset(comm, Algae_Spp.== "Sargassum")
qqnorm(comm_sarg$Algae_Wd)
qqline(comm_sarg$Algae_Wd)
hist(comm_sarg$Algae_Wd)

#macro
comm_mac<-subset(comm, Algae_Spp.== "Macro")
qqnorm(comm_mac$Algae_Wd)
qqline(comm_mac$Algae_Wd)
hist(comm_mac$Algae_Wd)

#ulva
comm_ulva<-subset(comm, Algae_Spp.== "Ulva")
qqnorm(comm_ulva$Algae_Wd)
qqline(comm_ulva$Algae_Wd)
hist(comm_ulva$Algae_Wd)

#silvetia
comm_sil<-subset(comm, Algae_Spp.== "Silvetia")
qqnorm(comm_sil$Algae_Wd)
qqline(comm_sil$Algae_Wd)
hist(comm_sil$Algae_Wd)

#centroceras
comm_cen<-subset(comm, Algae_Spp.== "Centroceras")
qqnorm(comm_cen$Algae_Wd)
qqline(comm_cen$Algae_Wd)
hist(comm_cen$Algae_Wd)

#Since we ar comparing NBS consumption, we will subset those values
#subset data the wrack treatments and only include NBS
NBS_Sub<-subset(comm, Algae_trt != "Wrack")
view(NBS_Sub)
is.factor(NBS_Sub$Rep_No.)
NBS_Sub$Rep_No.<-as.factor(NBS_Sub$Rep_No.)

#subset data to show only the columns we need
NBS_Sub2 <- NBS_Sub[, c("Rep_No.","Wrack_treatment", "Algae_Spp.","Algae_Wd")]
view(NBS_Sub2)
str(NBS_Sub2) #ensure variables are numeric or factors

#histograms for the data separated by treatment
hist(NBS_Sub2[NBS_Sub2$Wrack_treatment == "Invasive" & NBS_Sub2$Algae_Spp. == "Ulva",]$Algae_Wd, breaks = 20)
hist(NBS_Sub2[NBS_Sub2$Wrack_treatment == "Invasive" & NBS_Sub2$Algae_Spp. == "Centroceras",]$Algae_Wd, breaks = 20)
hist(NBS_Sub2[NBS_Sub2$Wrack_treatment == "Invasive" & NBS_Sub2$Algae_Spp. == "Silvetia",]$Algae_Wd, breaks = 20)
hist(NBS_Sub2[NBS_Sub2$Wrack_treatment == "Native" & NBS_Sub2$Algae_Spp. == "Ulva",]$Algae_Wd, breaks = 20)
hist(NBS_Sub2[NBS_Sub2$Wrack_treatment == "Native" & NBS_Sub2$Algae_Spp. == "Centroceras",]$Algae_Wd, breaks = 20)
hist(NBS_Sub2[NBS_Sub2$Wrack_treatment == "Native" & NBS_Sub2$Algae_Spp. == "Silvetia",]$Algae_Wd, breaks = 20)

#boxplot
boxplot(Algae_Wd ~ Wrack_treatment * Algae_Spp., data = comm, xlab = "Wrack_treatment.Algae_Spp.", ylab = "Algae_Wd")

#visualize potential interactrions
with(NBS_Sub2, interaction.plot(Algae_Spp., Wrack_treatment, Algae_Wd, ylim = c(0,max(NBS_Sub2$Algae_Wd))))

```

## Model and assumptions
```{r}
#############lets check the assumptions##############

#Create linear model
#model 1 includes NBS and wrack species as "SH, MP"
commmodel1<-lme(Algae_Wd~ Wrack_treatment + Algae_Spp.,random = ~1 | Rep_No., data = comm)
coef(commmodel1)
plot(commmodel1)
check_model(commmodel1)

#model 2 includes NBS and wrack species as "wrack"
commmodel2<-lme(Algae_Wd~Wrack_treatment + Algae_trt, random = ~1 | Rep_No., data = comm)
coef(commmodel2)
plot(commmodel2)
check_model(commmodel2)
install.packages("cran")

#model 3
commmodel3<-lme(Algae_Wd~ Wrack_treatment + Algae_Spp., random = ~1 | Rep_No., data = NBS_Sub)
coef(commmodel3)
plot(commmodel3)
check_model(commmodel3)

#variabilty likely caused by higher consumption of silvetia with and without a treatment effect. before proceeding with model 3 we will normalize and scale the data to compare variance. If variance is not different between seaweed treatments, we will proceed with Model 3

# Scale the values by category
comm_scaled <- NBS_Sub2 %>% group_by(Algae_Spp.) %>% mutate(scaled_Wd= scale(Algae_Wd))
view(comm_scaled) # Print out the scaled values
#visualize boxplots for algae weight by species
boxplot(scaled_Wd ~ Algae_Spp., data = comm_scaled, xlab = "Wrack_treatment.Algae_Spp.", ylab = "Algae_Wd")
scale_test<-lm(scaled_Wd~Algae_Spp., data = comm_scaled) #create linear model to test if variability is zero
#H0: there is no difference in the variability means between species
#Ha: there is a difference in the variability means between species
summary(scale_test)
anova(scale_test)
#fail to reject the null hypothesis, there is no difference in means. proceed with model 3 

```

## Wrack vs Native Benthic Seaweed Analyses

```{r}

#lets see if total consumption of ALL Seaweeds differed by wrack treatment using a T-test
#H0: There is no difference in total consumption between S. horneri and M. pyrifera treatments
#HA: There is a difference in total consumption between S. horneri and M. pyrifera treatments
t.test(community$Total_Algae_Consumed~community$Wrack_treatment, alt="two.sided", paired=F,conf.level=0.95)

mean(community$Total_Algae_Consumed[community$Wrack_treatment== 'M'],na.rm = T)
sd(community$Total_Algae_Consumed[community$Wrack_treatment== 'M'],na.rm = T)

mean(community$Total_Algae_Consumed[community$Wrack_treatment== 'S'],na.rm = T)
sd(community$Total_Algae_Consumed[community$Wrack_treatment== 'S'],na.rm = T)
## We fail to reject the null hypothesis (p-value = 0.215) 

ggplot(community, aes(x = Wrack_treatment, y=Total_Algae_Consumed)) + geom_boxplot()

#### now we test if consumption of WRACK differed. ie., is one wrack species less palatable than the other.?
#H0: There is no difference in consumption between S. horneri and M. pyrifera 
#HA: There is a difference in  consumption between S. horneri and M. pyrifera 
t.test(community$Total_Wrack_Algae_Consumed~community$Wrack_treatment, alt="two.sided", paired=F,conf.level=0.95)
##we reject the null hypothesis and embrace the alternative, there was a difference in consumption between wrack species. Consumption of M. pyrifera was significantly higher (p=3.457e-08)


#lets see if total consumption of NBS  differed by wrack treatment using a T-test
#H0: There is no difference in total NBS consumption between S. horneri and M. pyrifera treatments
#HA: There is a difference in total NBS consumption between S. horneri and M. pyrifera treatments
t.test(community$Total_Benthic_Algae_Consumed~community$Wrack_treatment, alt="two.sided", paired=F,conf.level=0.95)

mean(community$Total_Benthic_Algae_Consumed[community$Wrack_treatment== 'M'],na.rm = T)
sd(community$Total_Benthic_Algae_Consumed[community$Wrack_treatment== 'M'],na.rm = T)

mean(community$Total_Benthic_Algae_Consumed[community$Wrack_treatment== 'S'],na.rm = T)
sd(community$Total_Benthic_Algae_Consumed[community$Wrack_treatment== 'S'],na.rm = T)
## We fail to reject the null hypothesis (p-value = 0.0697). While total consumption is not different between NBS, we still want to know if lower palatability of S. horneri causes a shift of consumption onto Native Benthic Seaweeds (NBS)
##(NBS= Algae_Spp. - M. pyrifera and S. horneri) consumption.##

#look at an scatterplot
scatter<-ggplot(community, aes(y=Algae_Wd , x= Algae_trt)) +  geom_jitter(aes(col=Wrack_treatment)) + geom_smooth(aes(col=Algae_Spp.), method="lm", se=F)
scatter
#In general, we see that consumption tends to be clustered equally for Ulva and Centroceras but there is a vertical shift in Silvetia consumption when going from M to S and the opposite for the wrack treatment

#Proceed with model 3
commmodel3<-lme(Algae_Wd~ Wrack_treatment + Algae_Spp., random = ~1 | Rep_No., data = NBS_Sub)

#Ho: There is no difference in consumption between wrack treatments
#H1: There is a difference in consumption between wrack treatments 
summary(commmodel3) 
#we reject the null hypothesis and accept the alternative: Consumption differs between wrack treatment

#goodness of fit with and without random effect
fitmod3<-lm(Algae_Wd~Wrack_treatment + Algae_Spp., data = NBS_Sub)
summary(fitmod3)
anova(commmodel3,fitmod3)
# p value = 0.0323, thus, the LMEM is better than the null model without random effects.

```

# Figures for Manuscript

```{r}
#choice
LabAssayWholeTissue <- read.csv("LabAssaysWholeTissue.csv",header=T)
View(LabAssayWholeTissue)
choice <- LabAssayWholeTissue[1:232,]

fig1<- ggplot(choice, aes(x=algae_spp., y= algae_Wd, fill = algae_spp.)) + geom_boxplot(show.legend = FALSE) + theme_bw()  + xlab("") + ylab("Algae Consumed (g)") + ggtitle("") + theme(axis.text=element_text(size=7),
        axis.title=element_text(size=10),plot.title =element_text(hjust = 0.5)) + 
  
  facet_grid(grazer_spp. ~., scales = "free_y", labeller = as_labeller(c("Haliotis cracherodii" = "H. cracherodii", "Tegula" = "T. funebralis", "Pachy" = "P. crassipes", "Pagurus" = "P. samuelis")),) +
theme(strip.text = element_text(face = "italic")) + 
  
 
  
  scale_x_discrete(limits = c("macro",  "sargassum"), labels=c("macro" = "M. pyrifera", "sargassum" = "S. horneri")) +
  theme(axis.text.x = element_text(face="italic", 
                           size=10))
  
fig1


# Define the order of factor levels for grazer_spp.
order_grazer_spp <- c("T. funebralis", "P. crassipes", "P. samuelis", "H. cracherodii")

# Define the order of factor levels for algae_spp.
order_algae_spp <- c("M. pyrifera", "S. horneri")

# Subset the data and convert the factor levels to the desired order
choice <- subset(LabAssayWholeTissue, 1:232)
choice$grazer_spp. <- factor(choice$grazer_spp., levels = order_grazer_spp)
choice$algae_spp. <- factor(choice$algae_spp., levels = order_algae_spp)

# Create the plot with reordered facet labels
ggplot(choice, aes(x=algae_spp., y= algae_Wd, fill = algae_spp.)) + 
  geom_boxplot(show.legend = FALSE) + 
  theme_bw()  + 
  xlab("") + 
  ylab("Algae Consumed (g)") + 
  ggtitle("") + 
  theme(axis.text=element_text(size=7),
        axis.title=element_text(size=10),
        plot.title =element_text(hjust = 0.5)) + 
  facet_grid(grazer_spp. ~., 
             scales = "free_y", 
             labeller = as_labeller(c("Haliotis cracherodii" = "H. cracherodii", 
                                       "Tegula" = "T. funebralis", 
                                       "Pachy" = "P. crassipes", 
                                       "Pagurus" = "P. samuelis")),
             # Specify the order of the factor levels for grazer_spp.
             levels = order_grazer_spp) + 
  theme(strip.text = element_text(face = "italic")) + 
  scale_x_discrete(limits = c("macro",  "sargassum"), 
                   labels = c("macro" = "M. pyrifera", 
                              "sargassum" = "S. horneri")) +
  theme(axis.text.x = element_text(face="italic", 
                                   size=10))


#performance
#this figure only shows final dry mass of non-shell tissue for tegula and red abalone. All other tissue will be in the appendix

fig2<- ggplot(performance, aes(x=diet, y= terminal_dry_tissue_mass, fill= diet)) + 
  geom_boxplot(show.legend = FALSE) + theme_bw() + 
  xlab("Diet") + 
  ylab("Dry Tissue Mass (g)") + 
  ggtitle("") + 
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12), plot.title =element_text(hjust = 0.5)) +
  facet_grid(grazer_spp. ~ ., scales = "free_y", labeller = as_labeller(c("red abalone" = "H. rufescence", "tegula" = "T. funebralis"))) +  theme(strip.text = element_text(face = "italic")) +
  
  scale_x_discrete(limits = c("starved", "macro", "mixed", "sargassum"), labels=c("starved" = "Starved", "macro" = "M. pyrifera",
                              "mixed" = "Mixed","sargassum" = "S. horneri")) +
   geom_vline(xintercept=c(1.5),linetype="dotted") +
   theme(axis.text.x = element_text(face="italic", 
                           size=10)) 

fig2

#rigthing times of H. rufesens
#make bargraph
rightingplot<- ggplot(gathered_obs, aes(x=diet, y=time, fill= trial)) + xlab("") + ylab("Time (sec)") + ggtitle("Righting Time Before and After Diet Treatment") + theme(axis.text=element_text(size=12)) + geom_bar(stat="identity",position=position_dodge()) + theme_minimal() +  
  scale_x_discrete(limits = c("starved", "macro", "mixed", "sargassum"), labels=c("starved" = "Starved", "macro" = "M. pyrifera","mixed" = "Mixed","sargassum" = "S. horneri")) +
   geom_vline(xintercept=c(1.5),linetype="dotted") +
  scale_fill_manual("",  values = c("righting_time_1" = "#1260AB", "righting_time_2" = "#009BFF"), labels=c("righting_time_1" = "Initial", "righting_time_2" = "Final")) 

rightingplot



#community plot
commplot<- ggplot(community, aes(x=Algae_trt, y=Algae_Wd, fill= Wrack_treatment)) + xlab("") + ylab("Algae Consumed (g)") + ggtitle("") + theme(axis.text=element_text(size=12)) + geom_boxplot() + theme_minimal() +
  scale_x_discrete(limits = c("Wrack", "Centroceras", "Ulva", "Silvetia"), labels=c("Wrack" = "Wrack", "Centroceras" = "C. clavulatum","Ulva" = "Ulva spp.","Silvetia" = "S. compressa")) +
   geom_vline(xintercept=c(1.5),linetype="dotted") +
  scale_fill_manual("Wrack Treatment",  values = c("M" = "#F8766D", "S" = "#00BFC4"), labels=c("M" = "M. pyrifera", "S" = "S. horneri")) 

commplot


```
